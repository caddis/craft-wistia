!function(e){Wistia={},Wistia.VideoSelectInput=Craft.BaseElementSelectInput.extend({init:function(){this.settings=arguments,this.base.apply(this,this.settings)},removeElements:function(e){if(this.settings.selectable&&this.elementSelect.removeItems(e),this.modal){var t=this.modal.$body.find(".js-element-tbody").children('[data-id="'+e.data("id")+'"]:first');t.enable(),this.modal.elementSelector.addItems(t)}e.children("input").prop("disabled",!0),this.$elements=this.$elements.not(e),this.updateAddElementsBtn(),this.onRemoveElements()},createModal:function(){return new Wistia.VideoSelectorModal(this,this.settings)}}),Wistia.VideoSelectorModal=Craft.BaseElementSelectorModal.extend({init:function(e,t){this.elementSelectInput=e,this.settings=t,this.base(null,this.settings)},onFadeIn:function(){this.videoDataLoaded||this._createElementIndex()},updateSelectBtnState:function(){this.$selectBtn&&(this.elementSelector.getTotalSelected()?this.enableSelectBtn():this.disableSelectBtn())},selectElements:function(){this.elementSelector.getTotalSelected()&&(this.elementSelector.getSelectedItems().each(e.proxy(function(t,i){var n=e(i),s=n.find(".element").clone().addClass("removable").prepend('<input name="'+this.settings.name+'[]" type="hidden" value="'+n.data("id")+'"><a class="delete icon" title="'+Craft.t("Remove")+'"></a>');n.disable(),this.elementSelector.removeItems(n),this.elementSelectInput.appendElement(s),this.elementSelectInput.animateElementIntoPlace(n,s),this.elementSelectInput.addElements(s)},this)),this.hide(),this.elementSelector.deselectAll())},_createElementIndex:function(){var t=Craft.getActionUrl("wistia/video/getModal",{projectIds:this.settings.projectIds});Craft.postActionRequest(t,e.proxy(function(e,t){"success"===t&&(this.$body.html(e),this._createElementSelector(),this._createElementSearch(),this.videoDataLoaded=!0)},this))},_createElementSelector:function(){if(!this.elementSelectorCreated){var t=this.$body.find(".js-element-tbody"),i=this.elementSelectInput.getDisabledElementIds();this.$elementRow=this.$body.find(".js-element-tr");var n=e.map(i,function(e){return"[data-id="+e+"]"});this.$elementRow.filter(n.join(",")).disable(),this.elementSelector=new Garnish.Select(t,this.$elementRow.filter(":not(.disabled)"),{filter:":not(.disabled)",onSelectionChange:e.proxy(this,"updateSelectBtnState")})}},_createElementSearch:function(){var t=this,i=t.$body.find(".search input"),n="hidden";i.on("keyup",function(){var i=e(this),s=i.val(),l=i.siblings();s.length?l.removeClass(n):l.addClass(n),t.filterSearchTimer&&clearTimeout(t.filterSearchTimer),t.filterSearchTimer=setTimeout(function(){t.$elementRow.each(function(t,i){var n=e(i);n.data("title").search(new RegExp(s,"i"))<0?n.hide():n.show()})},300)}),i.siblings(".clear").on("click",function(){e(this).addClass(n).siblings("input").val(""),t.$elementRow.show()})}})}(jQuery);