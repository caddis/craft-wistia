!function(e){Wistia={},Wistia.VideoSelectInput=Craft.BaseElementSelectInput.extend({init:function(){this.settings=arguments,this.base.apply(this,this.settings)},removeElements:function(e){if(this.settings.selectable&&this.elementSelect.removeItems(e),this.modal){var t=this.modal.$body.find(".js-element-tbody").children('[data-id="'+e.data("id")+'"]:first');t.removeClass("disabled"),this.modal.elementSelector.addItems(t)}e.children("input").prop("disabled",!0),this.$elements=this.$elements.not(e),this.updateAddElementsBtn(),this.onRemoveElements()},createModal:function(){return new Wistia.VideoSelectorModal(this,this.settings)}}),Wistia.VideoSelectorModal=Craft.BaseElementSelectorModal.extend({init:function(e,t){this.elementSelectInput=e,this.settings=t,this.base(null,this.settings)},onFadeIn:function(){this.videoDataLoaded||this._createElementIndex()},updateSelectBtnState:function(){this.$selectBtn&&(this.elementSelector.getTotalSelected()?this.enableSelectBtn():this.disableSelectBtn())},selectElements:function(){var t="disabled";this.elementSelector.getTotalSelected()&&(this.elementSelector.getSelectedItems().each(e.proxy(function(i,n){var s=e(n),l=s.find(".element").clone().addClass("removable").prepend('<input name="'+this.settings.name+'[]" type="hidden" value="'+s.data("id")+'"><a class="delete icon" title="'+Craft.t("Remove")+'"></a>');s.addClass(t),this.elementSelector.removeItems(s),this.elementSelectInput.appendElement(l),this.elementSelectInput.animateElementIntoPlace(s,l),this.elementSelectInput.addElements(l)},this)),this.hide(),this.elementSelector.deselectAll())},_createElementIndex:function(){var t={projectIds:this.settings.projectIds};Craft.postActionRequest(Craft.getActionUrl("wistia/video/getModal"),t,e.proxy(function(e,t){"success"===t&&(this.$body.html(e),this._createElementSelector(),this._createElementSearch(),this.videoDataLoaded=!0)},this))},_createElementSelector:function(){if(!this.elementSelectorCreated){var t=this.$body.find(".js-element-tbody"),i=this.elementSelectInput.getDisabledElementIds();this.$elementRow=this.$body.find(".js-element-tr"),i.length&&this.$elementRow.each(e.proxy(function(t,n){var s=e(n);i.forEach(function(e){s.data("id")===e&&s.addClass("disabled")})},this)),this.elementSelector=new Garnish.Select(t,this.$elementRow.filter(":not(.disabled)"),{filter:":not(.disabled)",onSelectionChange:e.proxy(this,"updateSelectBtnState")})}},_createElementSearch:function(){var t=this;t.$body.find(".search input").on("keyup",function(){var i=e(this);t.filterSearchTimer&&clearTimeout(t.filterSearchTimer),t.filterSearchTimer=setTimeout(function(){var n=i.val();t.$elementRow.each(function(t,i){var s=e(i);s.toggle(s.data("title").search(new RegExp(n,"i"))<0)})},300)})}})}(jQuery);